# Appendix {#appendix}


Here are summaries of the overall results of my own testing.

## Gut Microbiome {#appendixGut}

Which are the most common gut taxa?  Let's look first at Phylum level

```{r, plotOverallPhylumVariability, echo= FALSE, warning = FALSE}
# 
# # plot the range of abundances for top taxa in PS
# plot_top <- function (ps) {
#   ps.top <- prune_taxa(names(sort(taxa_sums(ps),TRUE)[1:25]), ps)
#   df <- as.data.frame(otu_table(ps.top))
#   df$taxa <- factor(row.names(df))
#   df <- gather(df, ssr, abundance, -taxa)
#   df$abundance <- df$abundance 
#   ggplot(data=df, aes(x=taxa,y=abundance)) + geom_boxplot() +
#     theme(axis.text.x = element_text(angle=90)) + coord_trans(y="identity") + ylab("Abundance (%)")
#   
# }

# plot_top(phylum.gut) + ylab("Sprague Log10 Abundance") + scale_y_log10() +
#   ggtitle("Top 25 Phylum Abundance")

mhg_plot_top(prune_taxa(taxa_sums(gut.phylum.norm)>500,gut.phylum.norm)) + ylab("Sprague Abundance")  +
  ggtitle("Top Phylum")
```


In these boxplot charts, the long box in the middle represents a range between 25 and 75 percentile. The line in the middle of the box is the median, and the other samples are shown as dots outside the middle 50%. The Y-axis uses a log scale to make it easier to see the more rare taxa.

The Genus level reflects this with more detail, and variability:

```{r, plotOverallGenusVariability, echo=FALSE, warning = FALSE}
# plot_top(phylum.gut) + ylab("Sprague Abundance")  +
#   ggtitle("Top 25 Phylum") +
#   scale_y_continuous(labels=function(x)x/10000) #+


mhg_plot_top(gut.norm) + ylab("Sprague Log10 (%) Abundance") + 
  scale_y_continuous(trans="log10",labels=function(x) x/10000) + 
  ggtitle("Top 25 Genus Abundance % (Gut)")

mhg_plot_top(gut.norm) + ylab("Sprague Log10 Abundance") + scale_y_log10() +
  ggtitle("Top 25 Genus Abundance (Gut)")

# plot_top(gut.norm) + ylab("Sprague Abundance")  +
#   ggtitle("Top 25 taxa abundance") + scale_y_continuous(labels=function(x)x/10000)
```

## Healthy ranges {#appendixHealthyRanges}

Our collection of `r length(sample_data(subset_samples(people.norm, Condition=="Healthy" & Site=="gut"))$Username)` samples we have determined are from healthy people shows the following ranges for the top 20 genera:

```{r appendixComputeHealthy}

#write.csv(na.omit(mhg_range_for(subset_samples(people.norm,Site=="gut" & Condition == "Healthy"))),file="healthy_ranges.csv")

h <- mhg_range_for(subset_samples(people.norm,Site=="gut" & Condition == "Healthy"))
h.sprague <- mhg_range_for(gut.norm.nodupes)

ggplot(data = h.sprague %>% arrange(desc(mean)) %>% top_n(20), aes(x=reorder(taxa,-mean),y=mean)) + 
  #geom_boxplot() +
  geom_linerange( aes(ymin = min, ymax = max)) + 
  geom_point(aes(y=median), color = "red") + 
  geom_point(aes(y=mean), color = "blue") + 
    theme(axis.text.x = element_text(size = 15, angle=90))  + 
    scale_y_log10(labels=function(x)x/10000) +
  labs(title="Healthy Ranges",subtitle = "Red = median, Blue = mean", x="Top 20 Taxa", y = "Abundance (log10 %)")

```

A complete list of all species ever found in my gut is in the supplemental materials.
```{r generateCSVforgutSpecies}
# uncomment this section to generate a file with all the species names found in my gut samples
# gut.species <- sort(taxa_names(sprague.species))
# write.table(gut.species,row.names = FALSE, col.names = FALSE, file = "spragueGutSpecies.csv")


```


## Mouth Microbiome {#appendixMyMouth}

Here are the Phylum level mouth samples:

```{r}
mhg_plot_top(subset_samples(sprague.phylum.norm, Site == "mouth"))  # also stored in the variable ```mouth```, created in "microbesInMouth".

a <- subset_samples(merge_phyloseq(people.family,sprague.family.norm), Site=="mouth" & Username != "cjt" & Date > "2016-02-01" & Date < "2017-09-01")
a <- prune_taxa(taxa_sums(a)>10000,a)
mhg_plot_top(prune_taxa(taxa_sums(a)>10000,a)) + ggtitle("Oral Microbiome Average Across Dozens of Samples (Species)")

#make_ord_for(a) + theme(legend.position = "none")

#make_ord_for(subset_samples(people.family,Site=="mouth" & Username != "cjt" & Date > "2016-02-01"))
```


## Skin Microbiome {#appendixMySkin}

First we look at the phylum level:

```{r}
mhg_plot_top(subset_samples(sprague.phylum.norm, Site == "skin"))
```

then genus:

```{r}
mhg_plot_top(subset_samples(sprague.genus.norm, Site == "skin"))
```


## Nose Microbiome {#appendixMyNose}

```{r}
mhg_plot_top(subset_samples(sprague.genus.norm, Site == "nose"))
```

